# [Redis的7个应用场景](http://www.cnblogs.com/NiceCui/p/7794659.html)

### 缓存——热数据

- 热点数据（经常会被查询，但是不经常被修改或者删除的数据），首选是使用redis缓存。
  - 毕竟强大到冒泡的QPS和极强的稳定性不是所有类似工具都有的，而且相比于memcached还提供了丰富的数据类型可以使用。
  - 另外，内存中的数据也提供了AOF和RDB等持久化机制可以选择，要冷、热的还是忽冷忽热的都可选。
- 结合具体应用需要注意一下：很多人用spring的AOP来构建redis缓存的自动生产和清除，过程可能如下：
  - select 数据库前查询redis，有的话使用redis数据，放弃select 数据库，没有的话，select 数据库，然后将数据插入redis。
  - update或者delete数据库前，查询redis是否存在该数据，存在的话先删除redis中数据，然后再update或者delete数据库中的数据。
- 上面这种操作，如果并发量很小的情况下基本没问题，但是高并发的情况请注意下面场景：
  - 线程A为了update先删掉了redis中的该数据；
  - 这时候线程B执行查询，发现redis中没有该数据，立刻执行了查询SQL，并且插入到redis中；
  - 回到刚才的线程A，这个线程压根不知道刚才那个线程B插入了原本应该删除的数据！
  - 于是这个redis中的错误数据就永远的存在了下去，直到下一个update或者delete。

### 计数器

- 诸如统计点击数等应用。由于单线程，可以避免并发问题，保证不会出错。
  - 命令：INCRBY。
- 记得把数据持久化，毕竟是redis只是存在了内存。

### 队列

- 相当于消息系统，ActiveMQ，RocketMQ等工具类似，但是个人觉得简单用一下还行，如果对于数据一致性要求高的话还是用RocketMQ等专业系统。
- 由于redis把数据添加到队列是返回添加元素在队列的第几位，所以可以做判断用户是第几个访问这种业务。
- 队列不仅可以把并发请求变成串行，并且还可以做队列或者栈使用。

### 位操作（大数据处理）

- 用于数据量上亿的场景下，例如几亿用户系统的签到，去重登录次数统计，某用户是否在线状态等等。
- 想想一下腾讯10亿用户，要几个毫秒内查询到某个用户是否在线，你能怎么做？
- 千万别说给每个用户建立一个key，然后挨个记（你可以算一下需要的内存会很恐怖，而且这种类似的需求很多，腾讯光这个得多花多少钱。。）好吧。这里要用到位操作——使用setbit、getbit、bitcount命令。
- 原理是：
- redis内构建一个足够长的数组，每个数组元素只能是0和1两个值，然后这个数组的下标index用来表示我们上面例子里面的用户id（必须是数字哈）。
- 那么很显然，这个几亿长的大数组就能通过下标和元素值（0和1）来构建一个记忆系统，上面我说的几个场景也就能够实现。
- 用到的命令是：setbit、getbit、bitcount。

### 分布式锁与单线程机制

- 验证前端的重复请求（可以自由扩展类似情况），可以通过redis进行过滤：
  - 每次请求将request IP、参数、接口等hash作为key存储redis（幂等性请求），设置多长时间有效期，然后下次请求过来的时候先在redis中检索有没有这个key，进而验证是不是一定时间内过来的重复提交。
- 秒杀系统，基于redis是单线程特征，防止出现数据库“爆破”。
- 全局增量ID生成，类似“秒杀”。

### 最新列表

- 例如新闻列表页面最新的新闻列表，如果总数量很大的情况下，尽量不要使用select a from A limit 10这种low货，尝试redis的 LPUSH命令构建List，一个个顺序都塞进去就可以啦。
- 不过万一内存清掉了咋办？也简单，查询不到存储key的话，用mysql查询并且初始化一个List到redis中就好了。

###  排行榜

- 谁得分高谁排名往上。命令：ZADD（有序集，sorted set）